---
tags:
  - 软路由
---

思路：给img镜像扩容，永久增大overlay的空间
# 一、在软路由中操作

需要借助移动磁盘，操作指令如下

```shell
root@iStoreOS:/mnt/usb1-1# cd /mnt/usb1-1/op/
root@iStoreOS:/mnt/usb1-1/op# ll
drwxr-xr-x    1 root     root             0 Sep 17 07:20 ./
drwxrwxrwx    1 root     root         61440 Sep 17 06:08 ../
-rwxr-xr-x    1 root     root     140167899 Sep 16 21:03 op.img.gz*
root@iStoreOS:/mnt/usb1-1/op# gzip -kd op.img.gz
root@iStoreOS:/mnt/usb1-1/op# ll -h
drwxr-xr-x    1 root     root           0 Sep 17 07:25 ./
drwxrwxrwx    1 root     root       60.0K Sep 17 06:08 ../
-rwxr-xr-x    1 root     root      416.0M Sep 17 07:26 op.img*
-rwxr-xr-x    1 root     root      133.7M Sep 16 21:03 op.img.gz*
root@iStoreOS:/mnt/usb1-1/op# dd if=/dev/zero bs=1M count=8192 >> op.img status=progress
8583643136 bytes (8.6 GB, 8.0 GiB) copied, 719 s, 11.9 MB/s
8192+0 records in
8192+0 records out
8589934592 bytes (8.6 GB, 8.0 GiB) copied, 719.557 s, 11.9 MB/s
root@iStoreOS:/mnt/usb1-1/op# ll -h
drwxr-xr-x    1 root     root           0 Sep 17 07:25 ./
drwxrwxrwx    1 root     root       60.0K Sep 17 06:08 ../
-rwxr-xr-x    1 root     root        8.4G Sep 17 07:39 op.img*
-rwxr-xr-x    1 root     root      133.7M Sep 16 21:03 op.img.gz*
root@iStoreOS:/mnt/usb1-1/op# parted op.img
GNU Parted 3.4
Using /mnt/usb1-1/op/op.img
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print
Model:  (file)
Disk /mnt/usb1-1/op/op.img: 9026MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      33.6MB  101MB   67.1MB  primary  ext2         boot
 2      134MB   403MB   268MB   primary
 3      436MB   2584MB  2147MB  primary

(parted) resizepart 3 100%
(parted) print
Model:  (file)
Disk /mnt/usb1-1/op/op.img: 9026MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      33.6MB  101MB   67.1MB  primary  ext2         boot
 2      134MB   403MB   268MB   primary
 3      436MB   9026MB  8590MB  primary

(parted) quit
root@iStoreOS:/mnt/usb1-1/op#
```

# 二、在wsl中操作

ubuntu安装coreutils （可以显示dd指令的进度）
```powershell
mars@MARS:~$ sudo apt update

mars@MARS:~$ sudo apt install coreutils

mars@MARS:~$ dd --version
dd (coreutils) 8.32
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <https://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by Paul Rubin, David MacKenzie, and Stuart Kemp.
mars@MARS:~$
```

扩容img
```powershell
mars@MARS:/mnt/e/Downloads/op$ ll
total 425988
drwxrwxrwx 1 mars mars      4096 Sep 17 09:09 ./
drwxrwxrwx 1 mars mars      4096 Sep 17 09:09 ../
-rwxrwxrwx 1 mars mars 436208128 Sep 16 21:03 op.img*
mars@MARS:/mnt/e/Downloads/op$ dd if=/dev/zero bs=1M count=8192 >> op.img status=progress
8565817344 bytes (8.6 GB, 8.0 GiB) copied, 108 s, 79.3 MB/s
8192+0 records in
8192+0 records out
8589934592 bytes (8.6 GB, 8.0 GiB) copied, 108.269 s, 79.3 MB/s
mars@MARS:/mnt/e/Downloads/op$ parted op.img
WARNING: You are not superuser.  Watch out for permissions.
GNU Parted 3.4
Using /mnt/e/Downloads/op/op.img
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) print
Model:  (file)
Disk /mnt/e/Downloads/op/op.img: 9026MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      33.6MB  101MB   67.1MB  primary  ext2         boot
 2      134MB   403MB   268MB   primary
 3      436MB   2584MB  2147MB  primary

(parted) resizepart 3 100%
(parted) print
Model:  (file)
Disk /mnt/e/Downloads/op/op.img: 9026MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      33.6MB  101MB   67.1MB  primary  ext2         boot
 2      134MB   403MB   268MB   primary
 3      436MB   9026MB  8590MB  primary

(parted) quit
mars@MARS:/mnt/e/Downloads/op$
```